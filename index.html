<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shree Chakrdhar Enterprises</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f4f4f4;padding:15px}
.box{background:#fff;padding:15px;margin:15px auto;max-width:900px;border-radius:6px}
h2,h3{text-align:center}
input,select,button{width:100%;padding:10px;margin:8px 0}
button{background:#000;color:#fff;border:none;cursor:pointer}
.car{border:1px solid #ddd;padding:10px;margin:10px 0}
.imgs{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:6px}
.imgs img{width:100%;height:80px;object-fit:cover;border-radius:4px}
.pending{color:orange;font-weight:bold}
.accepted{color:green;font-weight:bold}
.rejected{color:red;font-weight:bold}
</style>
</head>

<body>

<h2>ðŸš— Shree Chakrdhar Enterprises</h2>

<!-- AVAILABLE CARS -->
<div class="box">
<h3>Available Cars</h3>
<div id="carsContainer"></div>
</div>

<!-- BOOKING -->
<div class="box">
<h3>Book Your Car</h3>
<form id="bookingForm">
<input id="custName" placeholder="Full Name" required>
<input id="custMobile" placeholder="Mobile Number" required>

<select id="custCar" required></select>

<input type="date" id="fromDate" required>
<input type="date" id="toDate" required>

<button type="submit">Book Now</button>
</form>
<p id="bookingMsg"></p>
</div>

<!-- STATUS -->
<div class="box">
<h3>Check Booking Status</h3>
<input id="checkMobile" placeholder="Mobile Number">
<button id="checkBtn">Check Status</button>
<p id="statusResult"></p>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyAceQf7DxVI9d_-HnVchw4tmiBCSy2P3NI",
  authDomain: "shree-chakrdhar-booking-ed24a.firebaseapp.com",
  projectId: "shree-chakrdhar-booking-ed24a"
});
const db = firebase.firestore();
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const carsContainer = document.getElementById("carsContainer");
  const custCar = document.getElementById("custCar");

  /* ===== FALLBACK CARS (GUARANTEED DISPLAY) ===== */
  const fallbackCars = [
    {name:"Maruti Fronx", price:2600},
    {name:"Swift", price:2200},
    {name:"i10", price:2000},
    {name:"Grand i10", price:2100},
    {name:"Scorpio S11", price:4500}
  ];

  function renderCars(cars){
    carsContainer.innerHTML="";
    custCar.innerHTML='<option value="">Select Car</option>';
    cars.forEach(c=>{
      custCar.innerHTML+=`<option>${c.name}</option>`;
      carsContainer.innerHTML+=`
        <div class="car">
          <b>${c.name}</b> â€“ â‚¹${c.price}/day
        </div>`;
    });
  }

  /* ===== TRY FIREBASE ===== */
  db.collection("cars").get()
    .then(snap=>{
      if(snap.empty){
        renderCars(fallbackCars);
      }else{
        const cars=[];
        snap.forEach(d=>{
          const x=d.data();
          cars.push({
            name:x.name || "Car",
            price:x.price || "-"
          });
        });
        renderCars(cars);
      }
    })
    .catch(()=>{
      renderCars(fallbackCars);
    });

  /* ===== BOOKING ===== */
  bookingForm.addEventListener("submit", e=>{
    e.preventDefault();
    db.collection("bookings").add({
      name:custName.value,
      mobile:custMobile.value,
      car:custCar.value,
      from:fromDate.value,
      to:toDate.value,
      status:"Pending",
      reason:"",
      createdAt:firebase.firestore.Timestamp.now()
    }).then(()=>{
      bookingMsg.innerHTML =
        '<span class="pending">Booking submitted. Waiting for approval.</span>';
      bookingForm.reset();
    });
  });

  /* ===== STATUS CHECK ===== */
  checkBtn.onclick=()=>{
    statusResult.innerHTML="";
    db.collection("bookings")
      .where("mobile","==",checkMobile.value)
      .orderBy("createdAt","desc")
      .limit(1)
      .get()
      .then(s=>{
        if(s.empty){statusResult.innerText="No booking found";return;}
        s.forEach(d=>{
          const x=d.data();
          statusResult.innerHTML=
            `<span class="${x.status.toLowerCase()}">
             ${x.status}${x.reason?" - "+x.reason:""}
             </span>`;
        });
      });
  };

});
</script>

</body>
</html>
